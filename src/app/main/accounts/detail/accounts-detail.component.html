<o-form-container breadcrumb="yes" breadcrumb-label-columns="ENTITYID;OFFICEID;CDID;ANID" breadcrumb-separator="-">
  <o-form #oForm attr="account_detail_form" service="branches" entity="account" keys="ACCOUNTID" keys-sql-types="INTEGER"
    columns="ACCOUNTID;BALANCE;ENTITYID;OFFICEID;CDID;ANID;ACCOUNTTYP" editable-detail="false" show-header="yes"
    header-actions="R;U;D" [label-header]="formLabel" show-header-navigation="yes" (onDataLoaded)="onFormDataLoaded($event)">

    <div fxLayout="row">
      <o-row attr="row1" fxFlex layout-padding layout-align="space-between start" class="rounded-panel" title-label="ACCOUNT">
        <o-column fxFlex="30">
          <span class="account-detail-span-title">{{ 'BALANCE' | oTranslate | uppercase }}</span>
          <span class="account-detail-balance">{{ oForm.getDataValue('BALANCE').value | oReal: {grouping:true,
            minDecimalDigits:2, maxDecimalDigits:2} }} €
          </span>
        </o-column>
        <o-column fxFlex="30">

          <span class="account-detail-span-title">{{ 'IBAN' | oTranslate | uppercase }}</span>
          <span class="account-detail-iban">{{ ibanLabel }} </span>

        </o-column>
        <o-column layout-align="center start" fxFlex="30" class="customer-list-container">

          <div fxLayout="row">
            <span class="account-detail-span-title">{{ 'CUSTOMERS' | oTranslate | uppercase }}</span>
            <!-- <mat-icon class="account-detail-add-customer" (click)="onAddCustomerClick()">add_circle_outline</mat-icon> -->
          </div>

          <o-list #customerList service="customers" entity="customerAccount" keys="CUSTOMERACCOUNTID" parent-keys="ACCOUNTID"
            columns="CUSTOMERACCOUNTID;CUSTOMERID;ACCOUNTID;NAME;SURNAME;ID" query-on-init="no" query-on-bind="yes"
            refresh-button="no" insert-button="no" selectable="false" quick-filter="false" dense="yes" controls="no">
            <mat-list-item *ngFor="let row of customerList.dataArray">
              <h4 mat-line>{{row.NAME}} {{ row.SURNAME }}</h4>
              <mat-icon mat-list-icon (click)="onRemoveCustomerClick(row)">delete</mat-icon>
            </mat-list-item>
          </o-list>

          <o-list-picker attr="customersPicker" class="display-none" (onChange)="onNewCustomerSelected($event)"
            #customerListPicker query-on-init="no" automatic-binding="no" query-on-bind="no" [static-data]="availableCustomersToAdd"
            required="no" enabled="yes" filter="yes" keys="CUSTOMERID" value-column="CUSTOMERID" parent-keys="ACCOUNTID"
            columns="ID;NAME;SURNAME" visible-columns="ID;NAME;SURNAME" separator=" - " dialog-width="500px">
          </o-list-picker>
        </o-column>

      </o-row>
    </div>

    <div fxLayout="row wrap" class="rounded-panel vertical-margin-8" fxLayoutAlign="space-between start" layout-padding>
      <o-column title-label="ACCOUNT_TRANSACTIONS_CHART" layout-fill="yes"  fxFlex="45" fxFlex.lt-lg="100">
        <o-chart #pieChart chart-height="350" type="donutChart" [data]="data" x-axis="MOVEMENTTYPES" y-axis="MOVEMENT"
          parent-keys="ACCOUNTID" [chart-parameters]="chartParameters"></o-chart>
      </o-column>
      <o-column title-label="ACCOUNT_BALANCE_CHART" layout-fill="yes" fxFlex="45" fxFlex.lt-lg="100">
        <o-chart chart-height="350" type="stackedAreaChart" x-label="{{ 'TIME' | oTranslate }}" y-label="{{ 'AMOUNT' | oTranslate }}"
          [data]="lineData" x-axis="DATE_" y-axis="BALANCE;MOVEMENT" x-data-type="time" parent-keys="ACCOUNTID"
          [chart-parameters]="chartParametersStackedArea"></o-chart>
      </o-column>

    </div>
    <!-- <o-column title-label="MOVEMENTS" layout-padding>
      <o-list #movementsList attr="movementsList" service="movements" entity="movement" keys="MOVEMENTID" parent-keys="ACCOUNTID"
        columns="ACCOUNTID;MOVEMENTID;DATE_;CONCEPT;MOVEMENT;MOVEMENTTYPEID" query-on-init="no" detail-form-route="transactions"
        pageable="yes" controls="no" style="height: 450px" class="movements-list">
        <mat-card *ngFor="let rowData of movementsList.dataArray" [o-list-item]="rowData">
          <mat-card-content fxLayout="column">
            <div fxLayout="row">
              <span fxFlex class="account-detail-balance">{{ rowData.CONCEPT }}</span>
              <span class="account-detail-balance">{{ rowData.MOVEMENT | currency:'EUR' }}</span>
            </div>
            <div fxLayout="row" fxLayoutAlign="end">
              <span>{{ rowData.DATE_ | date }}</span>
            </div>
          </mat-card-content>
        </mat-card>
      </o-list>
    </o-column> -->

    <div fxLayout="row">
      <div fxLayout="row" fxFlex class="rounded-panel" layout-padding>
        <o-table fxFlex service="movements" entity="movement" keys="MOVEMENTID" parent-keys="ACCOUNTID"
          detail-form-route="transactions" insert-form-route="transactions/new" edit-form-route="transactions" columns="ACCOUNTID;MOVEMENTID;DATE_;CONCEPT;MOVEMENT;MOVEMENTTYPES"
          visible-columns="DATE_;CONCEPT;MOVEMENT;MOVEMENTTYPES" title="MOVEMENTS" sort-columns="DATE_" query-on-init="false"
          query-rows="5" quick-filter="yes" (change)="onTableDataChange($event)" pageable="no">

          <o-table-columns-filter></o-table-columns-filter>

          <o-table-column attr="DATE_" title="DATE_" type="date" format="LL" width="30%"></o-table-column>
          <o-table-column attr="CONCEPT" title="CONCEPT" width="18%"></o-table-column>
          <o-table-column attr="MOVEMENT" title="MOVEMENT" width="18%" type="currency" currency-symbol="€"
            currency-symbol-position="right" thousand-separator="." decimal-separator=","></o-table-column>
          <o-table-column attr="MOVEMENTTYPES" title="MOVEMENTTYPES">
            <movement-types-cell-renderer>
            </movement-types-cell-renderer>
          </o-table-column>
        </o-table>
      </div>
    </div>


  </o-form>
</o-form-container>
